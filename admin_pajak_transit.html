<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <title>Finex Pos | Transit Bill Pajak Manual</title>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <style>
        :root { --primary: #2c3e50; --accent: #e91e63; --bg: #f4f7f6; --success: #27ae60; }
        body { font-family: 'Segoe UI', sans-serif; background: var(--bg); display: flex; justify-content: center; align-items: center; height: 100vh; margin: 0; }
        .card { background: white; padding: 30px; border-radius: 15px; box-shadow: 0 10px 25px rgba(0,0,0,0.1); width: 100%; max-width: 450px; }
        h2 { color: var(--primary); margin-top: 0; border-bottom: 2px solid #eee; padding-bottom: 10px; font-size: 20px; }
        .input-group { margin-bottom: 15px; }
        label { display: block; font-size: 12px; font-weight: bold; color: #666; margin-bottom: 5px; text-transform: uppercase; }
        input { width: 100%; padding: 12px; border: 1px solid #ddd; border-radius: 8px; box-sizing: border-box; font-size: 14px; outline: none; }
        input:focus { border-color: var(--accent); }
        .info-omzet { background: #f8f9fa; padding: 10px; border-radius: 8px; margin-bottom: 20px; font-size: 13px; color: #555; border-left: 4px solid var(--primary); }
        .btn-process { background: var(--primary); color: white; border: none; padding: 15px; width: 100%; border-radius: 8px; font-weight: bold; cursor: pointer; transition: 0.3s; font-size: 14px; }
        .btn-process:hover { background: #1a252f; }
        .status-msg { margin-top: 20px; padding: 10px; border-radius: 8px; display: none; text-align: center; font-size: 13px; }
    </style>
</head>
<body>

<div class="card">
    <h2>Input Transit Pajak</h2>
    <p style="font-size: 12px; color: #888; margin-bottom: 20px;">Memindahkan nilai pendapatan ke akun Hutang Pajak (2102) secara manual.</p>

    <div class="input-group">
        <label>Tanggal Jurnal</label>
        <input type="date" id="tgl-jurnal">
    </div>

    <div class="input-group">
        <label>Keterangan</label>
        <input type="text" id="keterangan" placeholder="Contoh: Setoran PPN Januari">
    </div>

    <div class="input-group">
        <label>Nominal Pajak (Rp)</label>
        <input type="number" id="nominal-pajak" placeholder="Masukkan angka saja..." style="font-size: 18px; font-weight: bold; color: var(--accent);">
    </div>

    <button class="btn-process" onclick="saveTransitPajak()">GENERATE JURNAL PAJAK ⚡</button>

    <div id="status" class="status-msg"></div>
</div>

<script>
    // Konfigurasi diambil dari file Anda yang lain
    const URL_DB = 'https://uojhjskgugghwxtdsfvm.supabase.co';
    const KEY_DB = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InVvamhqc2tndWdnaHd4dGRzZnZtIiwicm9sZSI6ImFub24iLCJpYXQiOjE3Njg2MTQ3OTQsImV4cCI6MjA4NDE5MDc5NH0.DZ5KfYYxy8yU2k1kgb8itJ7knefgX1k5NrUOdpgN0QM';
    const db = window.supabase.createClient(URL_DB, KEY_DB);

    window.onload = () => {
        document.getElementById('tgl-jurnal').value = new Date().toISOString().split('T')[0];
    };

    async function saveTransitPajak() {
        const tgl = document.getElementById('tgl-jurnal').value;
        const ket = document.getElementById('keterangan').value || "Transit Pajak Manual";
        const nominal = parseFloat(document.getElementById('nominal-pajak').value || 0);
        const statusDiv = document.getElementById('status');

        if (nominal <= 0) return alert("Masukkan nominal pajak yang valid!");

        if (!confirm(`Konfirmasi Jurnal:\n- Debit: 4101 (Pendapatan)\n- Kredit: 2102 (Hutang Pajak)\nNominal: Rp ${nominal.toLocaleString()}\n\nLanjutkan?`)) return;

        try {
            const noBukti = `TAX-MAN-${Date.now().toString().slice(-5)}`;
            const tglISO = tgl + "T12:00:00Z";

            const { error } = await db.from('jurnal_umum').insert([
                { 
                    tanggal: tglISO, 
                    no_bukti: noBukti, 
                    kode_akun: '4101', 
                    keterangan: ket, 
                    debit: nominal, // Mengurangi Pendapatan
                    kredit: 0 
                },
                { 
                    tanggal: tglISO, 
                    no_bukti: noBukti, 
                    kode_akun: '2102', 
                    keterangan: ket, 
                    debit: 0, 
                    kredit: nominal // Menambah Hutang Pajak
                }
            ]);

            if (error) throw error;

            statusDiv.style.display = "block";
            statusDiv.style.background = "#dcfce7";
            statusDiv.style.color = "#16a34a";
            statusDiv.innerText = "✅ Jurnal Berhasil Disimpan!";
            
            document.getElementById('nominal-pajak').value = "";
            
        } catch (e) {
            alert("Gagal: " + e.message);
        }
    }
</script>
</body>
</html>
