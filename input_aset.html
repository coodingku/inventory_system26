<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Finex Pos | Catat Aset Tetap</title>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script src="supabase-init.js"></script>

    <style>
        :root { --primary: #2c3e50; --accent: #3498db; --bg: #f4f7f6; --success: #27ae60; --danger: #e74c3c; }
        body { font-family: 'Segoe UI', sans-serif; display: flex; margin: 0; background: var(--bg); height: 100vh; overflow: hidden; }
        
        /* SIDEBAR STYLE */
        nav { width: 240px; background: var(--primary); color: white; padding: 20px; display: flex; flex-direction: column; box-sizing: border-box; z-index: 100; }
        nav h2 { color: var(--accent); margin-bottom: 30px; text-align: center; border-bottom: 1px solid #444; padding-bottom: 10px; }
        nav a { color: #bdc3c7; text-decoration: none; padding: 12px; border-radius: 8px; margin-bottom: 8px; display: block; font-size: 14px; }
        nav a:hover, nav a.active { background: var(--accent); color: white; }
        
        /* MAIN CONTENT */
        main { flex: 1; padding: 40px; display: flex; justify-content: center; align-items: flex-start; overflow-y: auto; }
        .card { background: white; padding: 30px; border-radius: 20px; box-shadow: 0 10px 25px rgba(0,0,0,0.1); width: 100%; max-width: 450px; }
        h2 { color: var(--primary); text-align: center; margin-bottom: 5px; }
        .sub-title { text-align: center; color: #888; font-size: 13px; margin-bottom: 25px; }
        
        label { font-size: 12px; font-weight: bold; color: #666; display: block; margin-bottom: 5px; }
        select, input { width: 100%; padding: 12px; margin-bottom: 15px; border-radius: 8px; border: 1px solid #ddd; font-size: 14px; box-sizing: border-box; }
        
        .btn-save { width: 100%; padding: 15px; background: var(--success); color: white; border: none; border-radius: 10px; font-weight: bold; cursor: pointer; transition: 0.3s; }
        .btn-save:hover { opacity: 0.9; }
        .btn-save:disabled { background: #ccc; cursor: not-allowed; }
        
        .info-shift { background: #e3f2fd; color: #1565c0; padding: 10px; border-radius: 8px; font-size: 12px; margin-bottom: 20px; text-align: center; }
        .user-info { margin-top: auto; padding: 15px; background: rgba(0,0,0,0.2); border-radius: 10px; font-size: 12px; color: #ddd; margin-bottom: 10px; }
        .btn-logout { background: #c0392b; color: white; text-align: center; padding: 12px; border-radius: 8px; cursor: pointer; font-weight: bold; }
    </style>
</head>
<body>

<nav>
    <h2 id="store-name-display">Finex Pos</h2>
    <a href="dashboard.html">üìä Dashboard</a>
    <a href="pos.html">üõí Kasir POS</a>
    <a href="laporan_neraca.html">‚öñÔ∏è Laporan Neraca</a>
    <a href="aset.html" class="active">üöö Catat Aset Tetap</a>
    
    <div class="user-info">
        <small>AKSES:</small> <b id="display-user-nav">...</b>
    </div>
    <div class="btn-logout" onclick="logout()">üö™ Keluar</div>
</nav>

<main>
    <div class="card">
        <h2 id="title-store">BeautyBloom</h2>
        <div class="sub-title">Input Inventaris & Aset Tetap</div>
        <div id="status-info" class="info-shift">Menghubungkan ke Database...</div>
        
        <label>Tanggal Pembelian:</label>
        <input type="date" id="ast-tanggal">

        <label>Kategori Aset:</label>
        <select id="ast-kategori">
            <option value="1301">1301 - Inventaris Peralatan Toko</option>
            <option value="1302">1302 - Kendaraan Operasional</option>
            <option value="1303">1303 - Bangunan / Renovasi</option>
            <option value="1304">1304 - Tanah</option>
        </select>

        <label>Nama Barang / Aset:</label>
        <input type="text" id="ast-nama" placeholder="Contoh: AC Sharp 1PK - Toko Depan">

        <label>Harga Perolehan (Rp):</label>
        <input type="number" id="ast-jumlah" placeholder="0">

        <label>Sumber Dana (Bayar Pakai):</label>
        <select id="ast-sumber">
            <option value="1102">Bank / QRIS (1102)</option>
            <option value="1101">Kas Utama (1101)</option>
            <option value="3101">Modal Pribadi (3101)</option>
        </select>

        <button id="btn-submit" class="btn-save" onclick="simpanAset()">üíæ SIMPAN ASET</button>
    </div>
</main>

<script>
    const session = JSON.parse(localStorage.getItem('finex_session'));

    window.onload = () => {
        document.getElementById('ast-tanggal').value = new Date().toISOString().split('T')[0];
        document.getElementById('title-store').innerText = sessionStorage.getItem('NAMA_TOKO') || "BeautyBloom";
        document.getElementById('display-user-nav').innerText = session ? session.username : "Admin";
        document.getElementById('status-info').innerHTML = "‚úÖ Database Terkoneksi";
    };

    async function simpanAset() {
        const tgl = document.getElementById('ast-tanggal').value;
        const kodeAset = document.getElementById('ast-kategori').value;
        const namaAset = document.getElementById('ast-nama').value;
        const jumlah = parseFloat(document.getElementById('ast-jumlah').value);
        const sumberDana = document.getElementById('ast-sumber').value;

        if(!namaAset || !jumlah || !tgl) return alert("Harap lengkapi semua data!");

        const btn = document.getElementById('btn-submit');
        btn.disabled = true;
        btn.innerText = "‚è≥ Menyimpan...";

        const noBukti = 'AST-' + Date.now();
        const tglFix = `${tgl}T${new Date().toTimeString().split(' ')[0]}`;

        try {
            // 1. Simpan ke tabel aset_tetap (Pendataan)
            const { error: err1 } = await db.from('aset_tetap').insert([{ 
                tanggal_beli: tgl, 
                kode_akun: kodeAset, 
                nama_aset: namaAset, 
                harga_perolehan: jumlah 
            }]);
            if (err1) throw err1;

            // 2. Simpan ke Jurnal Umum (Akuntansi)
            // Debit: Aset (13xx), Kredit: Kas/Bank (11xx)
            const dataJurnal = [
                { tanggal: tglFix, no_bukti: noBukti, kode_akun: kodeAset, keterangan: `Beli Aset: ${namaAset}`, debit: jumlah, kredit: 0 },
                { tanggal: tglFix, no_bukti: noBukti, kode_akun: sumberDana, keterangan: `Pembelian Aset: ${namaAset}`, debit: 0, kredit: jumlah }
            ];
            
            const { error: err2 } = await db.from('jurnal_umum').insert(dataJurnal);
            if (err2) throw err2;

            alert("‚úÖ Berhasil! Aset telah dicatat di Inventaris dan Jurnal Umum.");
            location.reload();

        } catch (e) {
            alert("Gagal menyimpan data: " + e.message);
            btn.disabled = false;
            btn.innerText = "üíæ SIMPAN ASET";
        }
    }

    function logout() { 
        if(confirm("Keluar dari sistem?")) {
            sessionStorage.clear();
            localStorage.clear(); 
            window.location.replace('login.html'); 
        }
    }
</script>
</body>
</html>
