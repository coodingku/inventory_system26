<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <title>Finex Pos | Manajemen Aset</title>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script src="supabase-init.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        :root { --primary: #2c3e50; --accent: #e91e63; --bg: #f4f7f6; --success: #27ae60; }
        body { font-family: 'Segoe UI', sans-serif; background: var(--bg); margin: 0; display: flex; }
        
        /* SIDEBAR STYLE */
        .sidebar { width: 250px; background: var(--primary); color: white; min-height: 100vh; padding: 20px; box-sizing: border-box; }
        .sidebar h2 { font-size: 18px; margin-bottom: 30px; border-bottom: 1px solid rgba(255,255,255,0.1); padding-bottom: 10px; }
        .sidebar a { display: block; color: #ecf0f1; text-decoration: none; padding: 12px; border-radius: 8px; margin-bottom: 5px; transition: 0.3s; }
        .sidebar a:hover { background: var(--accent); }
        .sidebar a i { margin-right: 10px; }

        /* MAIN CONTENT */
        .main-content { flex: 1; padding: 40px; box-sizing: border-box; }
        .container { display: grid; grid-template-columns: 400px 1fr; gap: 30px; }
        
        .card { background: white; padding: 25px; border-radius: 15px; box-shadow: 0 4px 15px rgba(0,0,0,0.05); }
        .form-group { margin-bottom: 15px; }
        label { display: block; font-weight: bold; margin-bottom: 5px; font-size: 13px; }
        input, select { width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 8px; }
        
        .btn-submit { background: var(--accent); color: white; border: none; padding: 12px; width: 100%; border-radius: 8px; font-weight: bold; cursor: pointer; }
        
        table { width: 100%; border-collapse: collapse; margin-top: 10px; background: white; border-radius: 8px; overflow: hidden; }
        th { background: #f8f9fa; padding: 12px; text-align: left; font-size: 13px; border-bottom: 2px solid #eee; }
        td { padding: 12px; border-bottom: 1px solid #eee; font-size: 13px; }
    </style>
</head>
<body>

<div class="sidebar">
    <h2><i class="fas fa-gem"></i> BeautyBloom</h2>
    <a href="dashboard.html"><i class="fas fa-home"></i> Dashboard</a>
    <a href="audit_rekosilisasi.html"><i class="fas fa-sync-alt"></i> Rekonsiliasi HPP</a>
    <a href="input_aset.html" style="background:var(--accent)"><i class="fas fa-truck-loading"></i> Manajemen Aset</a>
    <a href="laporan_neraca.html"><i class="fas fa-balance-scale-left"></i> Laporan Neraca</a>
</div>

<div class="main-content">
    <div class="container">
        <div class="card">
            <h3><i class="fas fa-plus-circle"></i> Tambah Aset Baru</h3>
            <div class="form-group">
                <label>Tanggal Beli</label>
                <input type="date" id="tgl_aset">
            </div>
            <div class="form-group">
                <label>Kategori Aset</label>
                <select id="kode_aset">
                    <option value="1301">1301 - Inventaris Peralatan</option>
                    <option value="1302">1302 - Kendaraan Operasional</option>
                    <option value="1303">1303 - Bangunan/Renovasi</option>
                </select>
            </div>
            <div class="form-group">
                <label>Nama Barang</label>
                <input type="text" id="nama_aset" placeholder="Misal: AC Samsung 1PK">
            </div>
            <div class="form-group">
                <label>Harga Perolehan</label>
                <input type="number" id="harga_aset" placeholder="0">
            </div>
            <div class="form-group">
                <label>Bayar Pakai</label>
                <select id="sumber_dana">
                    <option value="1102">Bank / QRIS (1102)</option>
                    <option value="1101">Kas Utama (1101)</option>
                </select>
            </div>
            <button class="btn-submit" onclick="simpanAset()">ðŸ’¾ Simpan Ke Database</button>
        </div>

        <div class="card">
            <h3><i class="fas fa-list"></i> Daftar Aset Terdaftar</h3>
            <table>
                <thead>
                    <tr>
                        <th>Tgl Beli</th>
                        <th>Nama Aset</th>
                        <th>Kategori</th>
                        <th>Harga</th>
                    </tr>
                </thead>
                <tbody id="tabel-aset-body">
                    </tbody>
            </table>
        </div>
    </div>
</div>

<script>
    document.getElementById('tgl_aset').value = new Date().toISOString().split('T')[0];

    async function loadAset() {
        const { data, error } = await db.from('aset_tetap').select('*').order('tanggal_beli', { ascending: false });
        if (data) {
            let html = '';
            data.forEach(a => {
                html += `<tr>
                    <td>${a.tanggal_beli}</td>
                    <td><b>${a.nama_aset}</b></td>
                    <td>${a.kode_akun}</td>
                    <td>Rp ${parseFloat(a.harga_perolehan).toLocaleString()}</td>
                </tr>`;
            });
            document.getElementById('tabel-aset-body').innerHTML = html;
        }
    }

    async function simpanAset() {
        const tgl = document.getElementById('tgl_aset').value;
        const kodeAset = document.getElementById('kode_aset').value;
        const nama = document.getElementById('nama_aset').value;
        const harga = parseFloat(document.getElementById('harga_aset').value);
        const sumber = document.getElementById('sumber_dana').value;

        if(!nama || !harga) return alert("Isi data dengan lengkap!");

        // 1. Simpan ke Tabel Khusus Aset
        const { error: errAset } = await db.from('aset_tetap').insert([{
            tanggal_beli: tgl, kode_akun: kodeAset, nama_aset: nama, harga_perolehan: harga
        }]);

        // 2. Simpan ke Jurnal Umum (Double Entry)
        const noBukti = "AST-" + Date.now().toString().slice(-4);
        const entries = [
            { tanggal: tgl, no_bukti: noBukti, kode_akun: kodeAset, keterangan: "Beli: "+nama, debit: harga, kredit: 0 },
            { tanggal: tgl, no_bukti: noBukti, kode_akun: sumber, keterangan: "Bayar: "+nama, debit: 0, kredit: harga }
        ];
        const { error: errJurnal } = await db.from('jurnal_umum').insert(entries);

        if(!errAset && !errJurnal) {
            alert("Aset & Jurnal Berhasil Disimpan!");
            loadAset();
        }
    }

    loadAset(); // Load data saat halaman dibuka
</script>
</body>
</html>
