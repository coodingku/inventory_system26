<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Backup Full Schema - Finex Pos</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        ::-webkit-scrollbar { width: 8px; }
        ::-webkit-scrollbar-track { background: #0f172a; }
        ::-webkit-scrollbar-thumb { background: #334155; border-radius: 10px; }
        pre { white-space: pre-wrap; word-wrap: break-word; }
    </style>
</head>
<body class="bg-slate-900 text-slate-200 font-sans">

    <div class="max-w-6xl mx-auto py-10 px-6">
        <div class="flex flex-col md:flex-row md:items-center justify-between mb-8 gap-4 bg-slate-800 p-6 rounded-2xl border border-slate-700 shadow-xl">
            <div>
                <h1 class="text-2xl font-bold text-white tracking-tight">Full Schema Backup (21 Tables)</h1>
                <p class="text-slate-400 text-sm">Finex Pos Database Structure (DDL)</p>
            </div>
            <div class="flex gap-3">
                <button onclick="copyToClipboard()" class="flex items-center gap-2 px-4 py-2 bg-slate-700 hover:bg-slate-600 text-white rounded-lg transition font-medium border border-slate-500">
                    <i class="fas fa-copy"></i> Copy SQL
                </button>
                <button onclick="downloadSchema()" class="flex items-center gap-2 px-4 py-2 bg-indigo-600 hover:bg-indigo-500 text-white rounded-lg transition font-medium shadow-lg">
                    <i class="fas fa-file-export"></i> Download .sql
                </button>
            </div>
        </div>

        <div class="bg-[#1e1e1e] rounded-2xl shadow-2xl overflow-hidden border border-slate-700">
            <div class="flex items-center justify-between px-5 py-3 bg-[#252526] border-b border-slate-800">
                <div class="flex gap-2">
                    <div class="w-3 h-3 rounded-full bg-red-500"></div>
                    <div class="w-3 h-3 rounded-full bg-yellow-500"></div>
                    <div class="w-3 h-3 rounded-full bg-green-500"></div>
                </div>
                <span class="text-slate-500 font-mono text-xs uppercase">db_structure_full.sql</span>
            </div>
            
            <div class="p-6 h-[700px] overflow-y-auto">
<pre id="schema-preview" class="text-blue-300 font-mono text-sm leading-relaxed">
<span class="text-slate-500">-- =========================================================
-- FINEX POS - COMPLETE DATABASE SCHEMA (21 TABLES)
-- =========================================================</span>

<span class="text-purple-400">-- [1] Users & Auth</span>
CREATE TABLE IF NOT EXISTS users (
    id uuid PRIMARY KEY DEFAULT gen_random_uuid(),
    username text UNIQUE,
    password text,
    role text,
    nama_lengkap text,
    created_at timestamptz DEFAULT now()
);

<span class="text-purple-400">-- [2] Master Produk & Inventory</span>
CREATE TABLE IF NOT EXISTS kategori (
    id uuid PRIMARY KEY DEFAULT gen_random_uuid(),
    nama_kategori text,
    created_at timestamptz DEFAULT now()
);

CREATE TABLE IF NOT EXISTS gudang (
    id uuid PRIMARY KEY DEFAULT gen_random_uuid(),
    nama_gudang text,
    lokasi text,
    created_at timestamptz DEFAULT now()
);

CREATE TABLE IF NOT EXISTS produk (
    id uuid PRIMARY KEY DEFAULT gen_random_uuid(),
    kode_barang text UNIQUE,
    nama_barang text,
    kategori_teks text,
    harga_jual int4,
    stok_sekarang int4,
    created_at timestamptz DEFAULT now(),
    gudang text,
    kategori_id uuid REFERENCES kategori(id),
    gudang_id uuid REFERENCES gudang(id),
    kategori text,
    harga_beli int4,
    stok_gudang int4
);

CREATE TABLE IF NOT EXISTS inventory (
    id uuid PRIMARY KEY DEFAULT gen_random_uuid(),
    kode_barang text,
    nama_barang text,
    kategori text,
    stok_minimal int4,
    stok_sekarang int4,
    harga_beli int4,
    harga_jual int4,
    created_at timestamptz DEFAULT now()
);

<span class="text-purple-400">-- [3] Riwayat Stok</span>
CREATE TABLE IF NOT EXISTS riwayat_stok (
    id uuid PRIMARY KEY DEFAULT gen_random_uuid(),
    id_produk uuid,
    tipe text,
    jumlah int4,
    keterangan text,
    admin_nama text,
    created_at timestamptz DEFAULT now(),
    stok_akhir int4
);

CREATE TABLE IF NOT EXISTS riwayat_restock (
    id uuid PRIMARY KEY DEFAULT gen_random_uuid(),
    created_at timestamptz DEFAULT now(),
    produk_id uuid,
    nama_produk text,
    jumlah int4,
    role text,
    catatan text
);

<span class="text-purple-400">-- [4] Penjualan & Transaksi (Versi A)</span>
CREATE TABLE IF NOT EXISTS penjualan (
    id uuid PRIMARY KEY DEFAULT gen_random_uuid(),
    no_invoice text UNIQUE,
    tanggal timestamptz,
    subtotal numeric,
    diskon_global numeric,
    pajak_ppn numeric,
    grand_total numeric,
    metode_pembayaran text,
    kasir_id uuid,
    created_at timestamptz DEFAULT now(),
    bayar numeric,
    kembali numeric,
    diskon numeric,
    pajak numeric,
    items jsonb
);

CREATE TABLE IF NOT EXISTS penjualan_detail (
    id uuid PRIMARY KEY DEFAULT gen_random_uuid(),
    penjualan_id uuid REFERENCES penjualan(id),
    produk_id uuid,
    nama_barang text,
    harga_satuan numeric,
    qty int4,
    diskon_item_persen numeric,
    subtotal_item numeric,
    created_at timestamptz DEFAULT now()
);

<span class="text-purple-400">-- [5] Transaksi & Detail (Versi B)</span>
CREATE TABLE IF NOT EXISTS transaksi (
    id uuid PRIMARY KEY DEFAULT gen_random_uuid(),
    no_struk text,
    nik_staff text,
    total_bayar int4,
    metode_bayar text,
    created_at timestamptz DEFAULT now()
);

CREATE TABLE IF NOT EXISTS detail_transaksi (
    id uuid PRIMARY KEY DEFAULT gen_random_uuid(),
    transaksi_id uuid REFERENCES transaksi(id),
    kode_barang text,
    nama_barang text,
    jumlah int4,
    harga_satuan int4,
    subtotal int4
);

<span class="text-purple-400">-- [6] Pembelian & Pengeluaran</span>
CREATE TABLE IF NOT EXISTS pembelian (
    id uuid PRIMARY KEY DEFAULT gen_random_uuid(),
    created_at timestamptz DEFAULT now(),
    produk_id uuid,
    qty int4,
    harga_beli numeric,
    supplier text,
    total_harga numeric
);

CREATE TABLE IF NOT EXISTS pengeluaran (
    id uuid PRIMARY KEY DEFAULT gen_random_uuid(),
    tanggal timestamptz DEFAULT now(),
    kategori text,
    keterangan text,
    jumlah numeric,
    kasir_id uuid
);

<span class="text-purple-400">-- [7] Akuntansi</span>
CREATE TABLE IF NOT EXISTS kategori_akun (
    nama_kategori text PRIMARY KEY,
    keterangan text,
    created_at timestamptz DEFAULT now()
);

CREATE TABLE IF NOT EXISTS akun (
    kode_akun text PRIMARY KEY,
    nama_akun text,
    kategori text,
    posisi_normal text,
    saldo numeric
);

CREATE TABLE IF NOT EXISTS jurnal (
    id int8 PRIMARY KEY,
    created_at timestamptz DEFAULT now(),
    keterangan text,
    kode_akun text,
    debet numeric,
    kredit numeric
);

CREATE TABLE IF NOT EXISTS jurnal_umum (
    id uuid PRIMARY KEY DEFAULT gen_random_uuid(),
    tanggal timestamptz DEFAULT now(),
    no_bukti text,
    kode_akun text,
    keterangan text,
    debit numeric,
    kredit numeric,
    created_at timestamptz DEFAULT now()
);

<span class="text-purple-400">-- [8] Staff & Kasir Log</span>
CREATE TABLE IF NOT EXISTS employee_staff (
    id uuid PRIMARY KEY DEFAULT gen_random_uuid(),
    nama_staff text,
    jabatan text,
    face_descriptor text,
    created_at timestamptz DEFAULT now()
);

CREATE TABLE IF NOT EXISTS presensi (
    id uuid PRIMARY KEY DEFAULT gen_random_uuid(),
    nama_staff text,
    waktu_masuk timestamptz,
    waktu_pulang timestamptz,
    status text,
    tanggal date,
    foto_masuk text,
    lokasi_masuk text
);

CREATE TABLE IF NOT EXISTS kasir_log (
    id uuid PRIMARY KEY DEFAULT gen_random_uuid(),
    tanggal date,
    waktu_buka timestamptz,
    waktu_tutup timestamptz,
    saldo_awal numeric,
    total_tunai_sistem numeric,
    total_tunai_fisik numeric,
    selisih numeric,
    status text,
    kasir_nama text,
    saldo_akhir numeric,
    waktu_closing timestamptz
);

<span class="text-purple-400">-- [9] Promo & Config</span>
CREATE TABLE IF NOT EXISTS diskon (
    id uuid PRIMARY KEY DEFAULT gen_random_uuid(),
    nama_diskon text,
    persen numeric,
    created_at timestamptz DEFAULT now()
);

CREATE TABLE IF NOT EXISTS ppn (
    id int4 PRIMARY KEY,
    nilai numeric,
    updated_at timestamptz DEFAULT now()
);

CREATE TABLE IF NOT EXISTS metode_pembayaran (
    id uuid PRIMARY KEY DEFAULT gen_random_uuid(),
    nama_metode text,
    aktif bool,
    created_at timestamptz DEFAULT now(),
    kode_akun text
);

CREATE TABLE IF NOT EXISTS pengaturan_toko (
    id int4 PRIMARY KEY,
    nama_toko text,
    latitude numeric,
    longitude numeric,
    radius_meter int4
);
</pre>
            </div>
        </div>
    </div>

    <script>
        function downloadSchema() {
            const content = document.getElementById('schema-preview').innerText;
            const blob = new Blob([content], { type: 'text/sql' });
            const url = window.URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'full_schema_finexpos_21_tables.sql';
            a.click();
        }

        function copyToClipboard() {
            const content = document.getElementById('schema-preview').innerText;
            navigator.clipboard.writeText(content);
            alert('SQL Berhasil disalin!');
        }
    </script>
</body>
</html>
