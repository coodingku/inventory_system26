<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Backup Database Skema - Finex Pos</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
</head>
<body class="bg-slate-50 flex items-center justify-center min-h-screen p-6">

    <div class="max-w-md w-full bg-white rounded-[2.5rem] p-8 shadow-xl text-center space-y-6 border border-slate-100">
        <div class="bg-indigo-100 w-20 h-20 rounded-full flex items-center justify-center mx-auto">
            <i data-lucide="database" class="text-indigo-600 w-10 h-10"></i>
        </div>
        
        <div>
            <h2 class="text-2xl font-black text-slate-900">Backup Skema DB</h2>
            <p class="text-slate-500 text-sm mt-2">Gunakan file ini untuk menyimpan struktur tabel database Finex Pos Anda sebagai cadangan.</p>
        </div>

        <div class="space-y-3">
            <button onclick="downloadDatabaseSchema()" class="w-full bg-indigo-600 text-white py-4 rounded-2xl font-black shadow-lg shadow-indigo-200 hover:bg-indigo-700 transition-all flex items-center justify-center gap-3">
                <i data-lucide="download" class="w-5 h-5"></i>
                Unduh Struktur (.sql)
            </button>
            
            <p class="text-[10px] text-slate-400 uppercase font-bold tracking-widest">Mencakup 21 Tabel Utama</p>
        </div>
        
        <div class="text-left bg-slate-50 p-4 rounded-2xl border border-slate-100">
            <p class="text-[9px] font-black text-slate-400 uppercase mb-2">Daftar Tabel Terdeteksi:</p>
            <ul class="text-[10px] font-bold text-slate-600 grid grid-cols-2 gap-1">
                <li>• users</li>
                <li>• produk</li>
                <li>• inventory</li>
                <li>• kategori</li>
                <li>• gudang</li>
                <li>• riwayat_stok</li>
                <li>• riwayat_restock</li>
                <li>• penjualan</li>
                <li>• penjualan_detail</li>
                <li>• transaksi</li>
                <li>• detail_transaksi</li>
                <li>• pembelian</li>
                <li>• pengeluaran</li>
                <li>• kategori_akun</li>
                <li>• akun</li>
                <li>• jurnal</li>
                <li>• jurnal_umum</li>
                <li>• employee_staff</li>
                <li>• presensi</li>
                <li>• kasir_log</li>
                <li>• diskon/ppn/metode</li>
            </ul>
        </div>
    </div>

    <script>
        function downloadDatabaseSchema() {
            const schemaSQL = `-- BACKUP STRUKTUR DATABASE - FINEX POS
-- Dihasilkan pada: ${new Date().toLocaleString('id-ID')}
-- Mencakup 21 Tabel sesuai skema blueprint

-- 1. Users
CREATE TABLE IF NOT EXISTS users (
  id uuid PRIMARY KEY DEFAULT gen_random_uuid(),
  username text UNIQUE,
  password text,
  role text,
  nama_lengkap text,
  created_at timestamptz DEFAULT now()
);

-- 2. Master Produk & Inventory
CREATE TABLE IF NOT EXISTS kategori (
  id uuid PRIMARY KEY DEFAULT gen_random_uuid(),
  nama_kategori text,
  created_at timestamptz DEFAULT now()
);

CREATE TABLE IF NOT EXISTS gudang (
  id uuid PRIMARY KEY DEFAULT gen_random_uuid(),
  nama_gudang text,
  lokasi text,
  created_at timestamptz DEFAULT now()
);

CREATE TABLE IF NOT EXISTS produk (
  id uuid PRIMARY KEY DEFAULT gen_random_uuid(),
  kode_barang text UNIQUE,
  nama_barang text,
  kategori_id uuid REFERENCES kategori(id),
  gudang_id uuid REFERENCES gudang(id),
  harga_beli int4,
  harga_jual int4,
  stok_sekarang int4,
  stok_gudang int4,
  created_at timestamptz DEFAULT now()
);

CREATE TABLE IF NOT EXISTS inventory (
  id uuid PRIMARY KEY DEFAULT gen_random_uuid(),
  kode_barang text,
  nama_barang text,
  kategori text,
  stok_minimal int4,
  stok_sekarang int4,
  harga_beli int4,
  harga_jual int4,
  created_at timestamptz DEFAULT now()
);

-- 3. Riwayat Stok
CREATE TABLE IF NOT EXISTS riwayat_stok (
  id uuid PRIMARY KEY DEFAULT gen_random_uuid(),
  id_produk uuid,
  tipe text,
  jumlah int4,
  keterangan text,
  admin_nama text,
  stok_akhir int4,
  created_at timestamptz DEFAULT now()
);

CREATE TABLE IF NOT EXISTS riwayat_restock (
  id uuid PRIMARY KEY DEFAULT gen_random_uuid(),
  produk_id uuid,
  nama_produk text,
  jumlah int4,
  role text,
  catatan text,
  created_at timestamptz DEFAULT now()
);

-- 4. Penjualan & Transaksi
CREATE TABLE IF NOT EXISTS penjualan (
  id uuid PRIMARY KEY DEFAULT gen_random_uuid(),
  no_invoice text UNIQUE,
  tanggal timestamptz,
  subtotal numeric,
  diskon_global numeric,
  pajak_ppn numeric,
  grand_total numeric,
  metode_pembayaran text,
  kasir_id uuid,
  bayar numeric,
  kembali numeric,
  items jsonb,
  created_at timestamptz DEFAULT now()
);

CREATE TABLE IF NOT EXISTS penjualan_detail (
  id uuid PRIMARY KEY DEFAULT gen_random_uuid(),
  penjualan_id uuid REFERENCES penjualan(id) ON DELETE CASCADE,
  produk_id uuid,
  nama_barang text,
  harga_satuan numeric,
  qty int4,
  subtotal_item numeric,
  created_at timestamptz DEFAULT now()
);

CREATE TABLE IF NOT EXISTS transaksi (
  id uuid PRIMARY KEY DEFAULT gen_random_uuid(),
  no_struk text,
  nik_staff text,
  total_bayar int4,
  metode_bayar text,
  created_at timestamptz DEFAULT now()
);

CREATE TABLE IF NOT EXISTS detail_transaksi (
  id uuid PRIMARY KEY DEFAULT gen_random_uuid(),
  transaksi_id uuid REFERENCES transaksi(id) ON DELETE CASCADE,
  kode_barang text,
  nama_barang text,
  jumlah int4,
  harga_satuan int4,
  subtotal int4
);

-- 5. Pembelian & Pengeluaran
CREATE TABLE IF NOT EXISTS pembelian (
  id uuid PRIMARY KEY DEFAULT gen_random_uuid(),
  produk_id uuid,
  qty int4,
  harga_beli numeric,
  supplier text,
  total_harga numeric,
  created_at timestamptz DEFAULT now()
);

CREATE TABLE IF NOT EXISTS pengeluaran (
  id uuid PRIMARY KEY DEFAULT gen_random_uuid(),
  tanggal timestamptz DEFAULT now(),
  kategori text,
  keterangan text,
  jumlah numeric,
  kasir_id uuid
);

-- 6. Akuntansi
CREATE TABLE IF NOT EXISTS kategori_akun (
  nama_kategori text PRIMARY KEY,
  keterangan text,
  created_at timestamptz DEFAULT now()
);

CREATE TABLE IF NOT EXISTS akun (
  kode_akun text PRIMARY KEY,
  nama_akun text,
  kategori text REFERENCES kategori_akun(nama_kategori),
  posisi_normal text,
  saldo numeric DEFAULT 0
);

CREATE TABLE IF NOT EXISTS jurnal (
  id int8 PRIMARY KEY,
  keterangan text,
  kode_akun text,
  debet numeric,
  kredit numeric,
  created_at timestamptz DEFAULT now()
);

CREATE TABLE IF NOT EXISTS jurnal_umum (
  id uuid PRIMARY KEY DEFAULT gen_random_uuid(),
  tanggal timestamptz,
  no_bukti text,
  kode_akun text,
  keterangan text,
  debit numeric,
  kredit numeric,
  created_at timestamptz DEFAULT now()
);

-- 7. Staff & Operasional
CREATE TABLE IF NOT EXISTS employee_staff (
  id uuid PRIMARY KEY DEFAULT gen_random_uuid(),
  nama_staff text,
  jabatan text,
  face_descriptor text,
  created_at timestamptz DEFAULT now()
);

CREATE TABLE IF NOT EXISTS presensi (
  id uuid PRIMARY KEY DEFAULT gen_random_uuid(),
  nama_staff text,
  waktu_masuk timestamptz,
  waktu_pulang timestamptz,
  status text,
  tanggal date,
  foto_masuk text,
  lokasi_masuk text
);

CREATE TABLE IF NOT EXISTS kasir_log (
  id uuid PRIMARY KEY DEFAULT gen_random_uuid(),
  tanggal date,
  waktu_buka timestamptz,
  waktu_tutup timestamptz,
  saldo_awal numeric,
  total_tunai_sistem numeric,
  total_tunai_fisik numeric,
  selisih numeric,
  status text,
  kasir_nama text,
  saldo_akhir numeric,
  waktu_closing timestamptz
);

-- 8. Config & Promo
CREATE TABLE IF NOT EXISTS diskon (
  id uuid PRIMARY KEY DEFAULT gen_random_uuid(),
  nama_diskon text,
  persen numeric,
  created_at timestamptz DEFAULT now()
);

CREATE TABLE IF NOT EXISTS ppn (
  id int4 PRIMARY KEY,
  nilai numeric,
  updated_at timestamptz DEFAULT now()
);

CREATE TABLE IF NOT EXISTS metode_pembayaran (
  id uuid PRIMARY KEY DEFAULT gen_random_uuid(),
  nama_metode text,
  aktif bool,
  kode_akun text,
  created_at timestamptz DEFAULT now()
);

CREATE TABLE IF NOT EXISTS pengaturan_toko (
  id int4 PRIMARY KEY,
  nama_toko text,
  latitude numeric,
  longitude numeric,
  radius_meter int4
);`;

            const blob = new Blob([schemaSQL], { type: 'text/sql' });
            const url = URL.createObjectURL(blob);
            const link = document.createElement("a");
            link.href = url;
            link.download = "Backup_Skema_FinexPos_21Tabel.sql";
            link.click();
            
            alert("Berhasil! Skema database Finex Pos telah diunduh.");
        }
        
        lucide.createIcons();
    </script>
</body>
</html>
