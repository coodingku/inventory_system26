<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Backup Media - Finex Pos</title>
    <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>üñºÔ∏è</text></svg>">
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
</head>
<body class="bg-transparent flex items-center justify-center min-h-screen p-6">

    <div class="max-w-md w-full bg-white rounded-[2.5rem] p-8 shadow-xl text-center space-y-6 border border-slate-100">
        <div class="bg-amber-100 w-20 h-20 rounded-full flex items-center justify-center mx-auto">
            <i data-lucide="image" class="text-amber-600 w-10 h-10"></i>
        </div>
        
        <div>
            <h2 class="text-2xl font-black text-slate-900">Backup Media</h2>
            <p class="text-slate-500 text-sm mt-2 font-medium">Cadangkan foto produk dan foto presensi staf ke dalam format .ZIP</p>
        </div>

        <div id="status-container" class="hidden">
            <div class="w-full bg-slate-100 rounded-full h-2 mb-2">
                <div id="progress-bar" class="bg-amber-600 h-2 rounded-full transition-all duration-300" style="width: 0%"></div>
            </div>
            <p id="status-text" class="text-[10px] font-bold text-slate-400 uppercase tracking-widest text-center">Mengompres file...</p>
        </div>

        <div class="space-y-3">
            <button id="btn-backup" onclick="startMediaBackup()" class="w-full bg-amber-600 text-white py-4 rounded-2xl font-black shadow-lg shadow-amber-200 hover:bg-amber-700 transition-all flex items-center justify-center gap-3">
                <i data-lucide="archive" class="w-5 h-5"></i>
                Unduh Semua Foto (.zip)
            </button>
            <p class="text-[10px] text-slate-400 uppercase font-bold tracking-widest uppercase">Foto Produk & Presensi</p>
        </div>
        
        <div class="text-left bg-slate-50 p-4 rounded-2xl border border-slate-100">
            <p class="text-[9px] font-black text-slate-400 uppercase mb-2 leading-relaxed">Informasi:</p>
            <ul class="text-[10px] text-slate-500 space-y-1">
                <li>‚Ä¢ Foto akan dikelompokkan per folder.</li>
                <li>‚Ä¢ Pastikan izin akses storage Supabase sudah publik.</li>
            </ul>
        </div>
    </div>

    <script>
        async function startMediaBackup() {
            const btn = document.getElementById('btn-backup');
            const statusContainer = document.getElementById('status-container');
            const progressBar = document.getElementById('progress-bar');
            const statusText = document.getElementById('status-text');

            btn.disabled = true;
            btn.classList.add('opacity-50', 'cursor-not-allowed');
            statusContainer.classList.remove('hidden');

            const zip = new JSZip();
            
            // Simulasi proses karena download file asli butuh iterasi URL Storage
            statusText.innerText = "Mengumpulkan link file...";
            progressBar.style.width = "40%";

            try {
                // Contoh: ZIP folder foto_staf
                // Di sini Anda bisa menambahkan loop untuk fetch URL dari Supabase
                zip.file("INFO_BACKUP.txt", "Backup Media Finex Pos\nTanggal: " + new Date().toLocaleString());
                
                statusText.innerText = "Membungkus ke ZIP...";
                progressBar.style.width = "80%";

                const content = await zip.generateAsync({type:"blob"});
                const url = URL.createObjectURL(content);
                const a = document.createElement("a");
                a.href = url;
                a.download = `Media_Backup_FinexPos_${new Date().toISOString().slice(0,10)}.zip`;
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);

                progressBar.style.width = "100%";
                statusText.innerText = "Selesai!";
            } catch (err) {
                alert("Gagal mencadangkan media.");
                console.error(err);
            } finally {
                setTimeout(() => {
                    statusContainer.classList.add('hidden');
                    btn.disabled = false;
                    btn.classList.remove('opacity-50', 'cursor-not-allowed');
                }, 2000);
            }
        }

        lucide.createIcons();
    </script>
</body>
</html>
